@{
    ViewData["Title"] = "الصفحة الرئيسية";
}

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="متجر الكتروني لبيع أدوات القرطاسية">
    <title id="homepage">الصفحة الرئيسية</title>
    <link rel="stylesheet" href="~/CSS/Styles.css">
    <link rel="stylesheet" href="~/CSS/Styles2.css">
    <link rel="icon" href="~/Images/ICO.png" type="image/png">
    <!-- Swiper CSS -->
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
    <!-- Swiper JS -->
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <a href="front_home">
        <img class="logo" src="~/Images/logo.png" alt="Logo">
    </a>
    <header>
        <div class="login-icon" id="login-icon">
            <button type="button" class="dropdown-btn">
                <img src="~/Images/user.png" alt="Login">
                <span class="login-text" id="login">تسجيل الدخول</span>
            </button>
            <div class="dropdown-content">
                <button type="button" class="btn-login" onclick="redirectToLogin()">تسجيل الدخول</button><br><br>
                <span class="new-user">مستخدم جديد <a href="front_signup" style="text-align: center;color: darkgoldenrod;text-decoration: underline;">ابدأ هنا</a></span>
            </div>
        </div>
        <div id="user-info" class="hidden">
            <a href="front_profile">
                <img src="~/Images/user.png" alt="أيقونة المستخدم" id="user-icon">
            </a>
            <span id="user-name">اسم المستخدم</span>
        </div>
        <div class="cart-icon">
            <img src="~/Images/cart.png" alt="Cart">
            <a href="front_cart">
                <span class="cart-text" id="cart">عربة التسوق</span>
            </a>
        </div>
        <div class="location-icon">
            <img src="~/Images/location.png" alt="location">
            <a href="#" class="location-text" id="deliveryLink">توصيل إلى سوريا</a>
            <div id="loginPopup">
                <button id="closeButton" class="close-button">&#10006;</button>
                <p>متجرنا لديه خدمة التوصيل و الشحن إلى جميع المحافظات السورية</p>
            </div>
        </div>
        <div class="logout-icon">
            <a href="#" onclick="logout()" id="logoutLink" style="display:none;">
                <img src="~/Images/log-out.png" alt="Logout">
                <span id="logout-text"> تسجيل الخروج</span>
            </a>
        </div>
        <h1> فئات المنتجات</h1>

        <!-- في section الرئيسية -->
        <section class="products-grid">
            <div class="product-item" id="category1">
                <img src="~/Images/Pens.png" alt="أقلام ">
                <h3><a href="front_pens">أقلام وأدوات كتابة</a></h3>
            </div>
            <div class="product-item" id="category2">
                <img src="~/Images/Notebook.png" alt="دفاتر">
                <h3><a href="front_notebooks">دفاتر وملاحظات</a></h3>
            </div>
            <div class="product-item" id="category3">
                <img src="~/Images/drawing-tools.jpg" alt="أدوات الرسم">
                <h3><a href="front_brushs">أدوات الرسم</a></h3>
            </div>
            <div class="product-item" id="category4">
                <img src="~/Images/set.png" alt="أدوات هندسية">
                <h3><a href="front_ruler">أدوات هندسية </a></h3>
            </div>
            <div class="product-item" id="category5">
                <img src="~/Images/office-tools.png" alt="أدوات مكتبية">
                <h3><a href="front_office"> أدوات مكتبية </a></h3>
            </div>
            <div class="product-item" id="category7">
                <img src="~/Images/paper.png" alt="أوراق ومفكرات">
                <h3><a href="front_notes">أوراق ومفكرات</a></h3>
            </div>
            <div class="product-item" id="category6">
                <img src="~/Images/backpack.png" alt="حقائب مدرسية">
                <h3><a href="front_schoolbags">حقائب مدرسية</a></h3>
            </div>
        </section>
        <br><br><br>
    </header>
    <main>

        <!-- Search form -->
        <div class="search-form">
            <form class="search-form" onsubmit="searchProducts(event)">
                <input type="text" id="search" name="search" placeholder="ابحث هنا...">
                <button type="submit">ابحث</button>
            </form>
        </div>

        <!-- Display search results -->
        <div id="search-results">
            <!-- Display search results here -->
        </div>


        <h1>مرحبًا بك في متجر القرطاسية</h1>
        <p>استكشف مجموعتنا الواسعة من المنتجات القرطاسية وتسوق بأسعار مميزة.</p>

        <!-- يمكنك أن تضيف هنا أي محتوى إضافي لصفحة الرئيسية -->
        <div class="swiper-container">
            <div class="swiper-wrapper">
                <!-- الشرائح ستتم إضافتها هنا -->
                <div class="swiper-slide">
                    <img src="~/Images/product3.jpg" alt="Product3">
                </div>
                <div class="swiper-slide">
                    <img src="~/Images/product1.png" alt="Product1 ">
                </div>
                <div class="swiper-slide">
                    <img src="~/Images/product2.jpg" alt="Product 2">
                </div>
            </div>
            <!-- إضافة التحكم للشرائح -->
            <div class="swiper-pagination"></div>
            <div class="swiper-button-next"></div>
            <div class="swiper-button-prev"></div>
        </div>
        <br><br>

        <h1 id="featuredProducts">المنتجات المميزة</h1>
        <section class="featured-products" style="width: 100%;">
            <div class="featured-Product">
                <div>
                    <h4 id="featuredProduct1Name">اسم المنتج المميز 1</h4>
                    <p id="featuredProduct1Description">وصف المنتج المميز 1</p>
                    <span id="price1">السعر: 15000 ل.س</span>
                </div>
                <div class="heart-container">
                    <!-- دائرة القلب -->
                    <div class="heart-circle">
                        <span class="heart" onclick="addHeart(this)">&#10084;</span>
                    </div>
                </div>
                <img src="~/Images/folomasterpen.JPG" alt="Featured Product 1">
            </div>

            <div class="featured-Product">
                <div>
                    <h4 id="featuredProduct2Name">اسم المنتج المميز 2</h4>
                    <p id="featuredProduct2Description">وصف المنتج المميز 2</p>
                    <span id="price2">السعر: 45000 ل.س</span>
                </div>
                <div class="heart-container">
                    <!-- دائرة القلب -->
                    <div class="heart-circle">
                        <span class="heart" onclick="addHeart(this)">&#10084;</span>
                    </div>
                </div>
                <img src="~/Images/santfic-calc.jpg" alt="Featured Product 2">
            </div>
            <div class="featured-Product">
                <div>
                    <h4 id="featuredProduct1Name">اسم المنتج المميز 3</h4>
                    <p id="featuredProduct1Description">وصف المنتج المميز 3</p>
                    <span id="price1">السعر: 35000 ل.س</span>
                </div>
                <div class="heart-container">
                    <!-- دائرة القلب -->
                    <div class="heart-circle">
                        <span class="heart" onclick="addHeart(this)">&#10084;</span>
                    </div>
                </div>
                <img src="~/Images/supplies-bags.jpg" alt="Featured Product 1">
            </div>
            <div class="featured-Product">
                <div>
                    <h4 id="featuredProduct1Name">اسم المنتج المميز 4</h4>
                    <p id="featuredProduct1Description">وصف المنتج المميز 4</p>
                    <span id="price1">السعر: 5000 ل.س</span>
                </div>
                <div class="heart-container">
                    <!-- دائرة القلب -->
                    <div class="heart-circle">
                        <span class="heart" onclick="addHeart(this)">&#10084;</span>
                    </div>
                </div>
                <img src="~/Images/highlighter.jpg" alt="Featured Product 1">
            </div>
            <!-- يمكنك إضافة المزيد من المنتجات المميزة هنا -->
        </section>
        <br>
    </main>
    <footer>
        <p dir="ltr">&copy; 2024 - جميع الحقوق محفوظة</p>
        |
        <a href="front_privacy_policy">سياسة الخصوصية</a>
        <a id="customerServiceLink" href="front_customer_service">خدمة العملاء</a>
        <a href="front_about">من نحن</a>
        |
        <div class="social-links">
            <strong>تواصل معنا:</strong>
            <a href="@(Url.Content("https://youtube.com/@-StationeryStore?si=XlmT8B-DREJrxxNw"))">
                <img src="~/Images/Youtube.png" alt="Youtube Icon">
            </a>

            <a href="https://www.facebook.com/profile.php?id=61558642717289&mibextid=ZbWKwL">
                <img src="~/Images/facebook-icon.png" alt="Facebook Icon">
            </a>

            <a href="https://web.whatsapp.com/">
                <img src="~/Images/phone-call.png" alt="Phone Icon">
            </a>

        </div>
    </footer>
    <script>
        // إخفاء رابط تسجيل الخروج ولوغو المستخدم وعرض رابط تسجيل الدخول
        document.getElementById('logoutLink').style.display = 'none';
        document.getElementById('user-info').style.display = 'none';
        document.getElementById('login-icon').style.display = 'inline-block';

        // التحقق من وجود الـ token في الجلسة
        const authToken = localStorage.getItem('authToken');
        console.log(authToken);
        // عندما يكون هناك token
        if (authToken) {
            // عرض رابط تسجيل الخروج ولوغو المستخدم
            document.getElementById('logoutLink').style.display = 'inline-block';
            document.getElementById('user-info').style.display = 'inline-block';
            document.getElementById('login-icon').style.display = 'none';

            // جلب بيانات المستخدم باستخدام التوكن
            fetch('/api/User', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + authToken
                }
            })
                .then(response => response.json())
                .then(userDataArray => {
                    console.log('User data:', userDataArray);

                    // استخراج معرف المستخدم من sessionStorage
                    const userData = JSON.parse(sessionStorage.getItem('userData'));
                    if (!userData || !userData.userId) {
                        console.error('User data not found in sessionStorage or missing userId.');
                        return;
                    }

                    // استخراج معرف المستخدم
                    const loggedInUserId = userData.userId;

                    // البحث عن بيانات المستخدم المرتبطة بالمعرف المسجل
                    const loggedInUser = userDataArray.find(user => user.id === loggedInUserId);
                    if (loggedInUser) {
                        // عرض بيانات المستخدم
                        document.getElementById("user-name").innerText = loggedInUser.username;
                    } else {
                        console.error('Logged in user data not found.');
                    }
                })
                .catch(error => console.error('Error fetching user data:', error));
        } else {
            // عندما لا يكون هناك token
            // إظهار رابط تسجيل الدخول وإخفاء رابط تسجيل الخروج ولوغو المستخدم
            document.getElementById('logoutLink').style.display = 'none';
            document.getElementById('user-info').style.display = 'none';
            document.getElementById('login-icon').style.display = 'inline-block';
        }


        function searchProducts(event) {
            event.preventDefault(); // منع السلوك الافتراضي لنموذج البحث

            const searchTerm = document.getElementById('search').value.trim(); // الحصول على مصطلح البحث وإزالة الفراغات الزائدة
            const searchResultsContainer = document.getElementById('search-results'); // الحصول على عنصر العرض لنتائج البحث

            // إرسال طلب GET إلى نهاية الويب API باستخدام fetch
            fetch(`/api/Product?search=${searchTerm}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to fetch search results');
                    }
                    return response.json();
                })
                .then(data => {
                    // معالجة البيانات المسترجعة هنا، على سبيل المثال، عرضها في عنصر العرض لنتائج البحث
                    displaySearchResults(data, searchResultsContainer);
                })
                .catch(error => {
                    console.error('Error fetching search results:', error);
                    // يمكنك إضافة تنبيه أو رسالة خطأ هنا
                });
        }

        function displaySearchResults(results, container) {
            console.log(results); // Log the results to inspect the structure

            var resultsContainer = document.getElementById('search-results');
            resultsContainer.innerHTML = '';

            if (results.length === 0) {
                resultsContainer.innerHTML = '<p>لا توجد نتائج.</p>';
                return;
            }

            results.forEach(product => {
                var productDiv = document.createElement('div');

                var titleElement = document.createElement('p');
                titleElement.textContent = product.name;
                productDiv.appendChild(titleElement);

                var descriptionElement = document.createElement('p');
                descriptionElement.textContent = product.description;
                productDiv.appendChild(descriptionElement);

                if (product.productAttributeQuantities && product.productAttributeQuantities.length > 0) {
                    var priceElement = document.createElement('p');
                    priceElement.textContent = `السعر: ${product.productAttributeQuantities[0].price} ل.س`;
                    productDiv.appendChild(priceElement);
                } else {
                    var priceElement = document.createElement('p');
                    priceElement.textContent = `السعر: ${product.productAttributeQuantities[0].price} ل.س`;
                    productDiv.appendChild(priceElement);
                }

                resultsContainer.appendChild(productDiv);
            });
        }


        function showContent(categoryId) {
            // Hide all tab contents first
            var tabContents = document.getElementsByClassName('tab-content');
            for (var i = 0; i < tabContents.length; i++) {
                tabContents[i].style.display = 'none';
            }

            // Display the selected category content
            var categoryElement = document.getElementById(categoryId);
            if (categoryElement) {
                categoryElement.style.display = 'block';
            }
            // Hide the content after 2 seconds (adjust as needed)
            setTimeout(function () {
                categoryElement.style.display = 'none';
            }, 2000);
        }
       
       
        const deliveryLink = document.getElementById('deliveryLink');
        const loginPopup = document.getElementById('loginPopup');
        const closeButton = document.getElementById('closeButton'); // إضافة زر الإغلاق

        deliveryLink.addEventListener('click', (event) => {
            event.preventDefault();
            loginPopup.style.display = 'block';

            // إغلاق الواجهة بعد 5 ثوان
            setTimeout(() => {
                loginPopup.style.display = 'none';
            }, 5000); // 5000 مللي ثانية = 5 ثوان
        });

        closeButton.addEventListener('click', () => {
            loginPopup.style.display = 'none';
        });
       
        function redirectToLogin() {
            window.location.href = "front_login";
        }
        // دالة للتنقل إلى الأقسام داخل الصفحة
        function scrollToSection(sectionId) {
            var section = document.getElementById(sectionId);
            if (section) {
                section.scrollIntoView({ behavior: 'smooth' });
            }
        }
        if (swiper) {
            swiper.destroy();
        }
        initializeSwiper();
        // تهيئة Swiper
        var swiper;

        function initializeSwiper() {
            swiper = new Swiper('.swiper-container', {
                slidesPerView: 1,
                spaceBetween: 10,
                navigation: {
                    nextEl: '.swiper-button-next',
                    prevEl: '.swiper-button-prev',
                },
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                },
                effect: 'cube',
                loop: true, // تمكين حلقة الشرائح
                autoplay: {
                    delay: 3500,
                    disableOnInteraction: false,
                },
                initialSlide: 0,
            });
        }


        function addHeart(element) {
            element.classList.toggle('active');
        }
        function toggleSubcategories(categoryId) {
            var subcategory = document.getElementById(categoryId);
            subcategory.style.display = subcategory.style.display === 'block' ? 'none' : 'block';
        }
       

        function logout() {
            // حذف الـ token من الجلسة
            localStorage.removeItem('authToken');

            // إخفاء رابط تسجيل الخروج ولوغو المستخدم
            document.getElementById('logoutLink').style.display = 'none';
            document.getElementById('userLogo').style.display = 'none';

            // إظهار رابط تسجيل الدخول
            document.getElementById('loginLink').style.display = 'inline-block';

            // توجيه المستخدم إلى الصفحة الرئيسية أو أي صفحة أخرى
            window.location.href = "front_home";
        }

       


    </script>

</body>
</html>
